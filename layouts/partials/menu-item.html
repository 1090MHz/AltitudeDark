{{ $separators := .Params.separators | default (slice) }}
{{ $depth := .Scratch.Get "menu-depth" }}
<li class="relative group/menu-depth-{{ $depth }}">
  <a href="{{ .Permalink }}" class="block px-2 py-1 text-[#f8fafb] hover:bg-[#1678b5]">
    {{ .Title }}
  </a>

  {{ if or .Sections .Pages }}
  <!-- Set the submenu class based on the depth -->
  {{ $ulClass := "" }}
  {{ if eq $depth 0 }}
  {{ $ulClass = printf "absolute hidden bg-[#23282e] list-none p-0 z-50 min-w-max top-full left-0 group-hover/menu-depth-%d:block" $depth }}
  {{ else }}
  {{ $ulClass = printf "absolute hidden bg-[#23282e] list-none p-0 z-50 min-w-max top-0 left-full ml-0 group-hover/menu-depth-%d:block" $depth }}
  {{ end }}

  <ul class="{{ $ulClass }}" aria-label="Submenu">
    <!-- Include subsections -->
    {{ range $index, $section := .Sections }}
    {{ .Scratch.Set "menu-depth" (add ($.Scratch.Get "menu-depth") 1) }}
    {{ partial "menu-item.html" $section }}
    {{ if in $separators (add $index 1) }}
    <li>
      <hr class="border-t border-[#5a6067] my-2" />
    </li>
    {{ end }}
    {{ end }}

    <!-- Include regular pages, but exclude _index.md -->
    {{ range $index, $page := .Pages }}
    {{ if not $page.IsSection }}
    <li>
      <a href="{{ $page.Permalink }}" class="block px-2 py-1 text-[#f8fafb] hover:bg-[#1678b5]">
        {{ $page.Title }}
      </a>
    </li>
    {{ if in $separators (add $index 1) }}
    <li>
      <hr class="border-t border-[#5a6067] my-2" />
    </li>
    {{ end }}
    {{ end }}
    {{ end }}
  </ul>
  {{ end }}
</li>