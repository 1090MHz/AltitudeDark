<!doctype html>
{{ $lang := .Params.lang | default .Site.LanguageCode | default "en" }}
<html lang="{{ $lang }}" class="dark">
  <head>
    {{ block "head" . }}{{ partial "head.html" . }}{{ end }}
  </head>

  <body
    class="bg-body-bg text-body-text font-comic flex min-h-screen flex-col dark:bg-gray-900 dark:text-gray-100"
  >
    <!-- ✅ Transparent, floating navbar -->
    <div
      id="navbar"
      class="fixed top-0 left-0 z-50 w-full bg-black/30 py-4 text-white transition-colors duration-300"
    >
      <nav class="flex w-full items-center justify-between pr-[10%] pl-[10%]">
        <!-- Hero Button -->
        <div class="flex flex-1 justify-start pl-[10vw]">
          {{ range $index, $page := where .Site.Pages "Section" "intro" }}
            {{ if eq $index 0 }}
              <a
                href="#section-{{ $index }}"
                data-link="section-{{ $index }}"
                class="nav-link bg-opacity-40 rounded-md bg-black px-4 py-2 transition-colors duration-300 hover:bg-gray-600 active:bg-gray-800"
              >
                {{ $page.Title }}
              </a>
            {{ end }}
          {{ end }}
        </div>

        <!-- Section Buttons -->
        <div class="flex flex-1 justify-end gap-1 pr-[5vw]">
          {{ range $index, $page := where .Site.Pages "Section" "intro" }}
            {{ if ne $index 0 }}
              <a
                href="#section-{{ $index }}"
                data-link="section-{{ $index }}"
                class="nav-link bg-opacity-40 rounded-md bg-black px-4 py-2 transition-colors duration-300 hover:bg-gray-600 active:bg-gray-800"
              >
                {{ $page.Title }}
              </a>
            {{ end }}
          {{ end }}
        </div>
      </nav>
    </div>

    <main
      class="bg-body-bg text-body-text font-comic w-full flex-grow p-0 dark:bg-gray-800 dark:text-gray-200"
    >
      <!-- ✅ DO NOT add top padding to compensate for navbar; we want the navbar to overlay this -->
      <div class="scroll-snap-type-y-mandatory h-screen overflow-y-scroll">
        {{ range $index, $page := where .Site.Pages "Section" "intro" }}
          <div
            id="section-{{ $index }}"
            class="scroll-snap-align-start relative flex h-screen items-center justify-center"
          >
            <!-- ✅ Fullscreen background image -->
            {{ with .Params.background_image }}
              <img
                src="{{ . }}"
                alt="Section {{ add $index 1 }} Image"
                class="absolute inset-0 z-0 h-full w-full object-cover"
              />
            {{ end }}


            <!-- Content Card -->
            <div class="relative z-10 w-full px-4">
              <div
                class="prose prose-invert prose-lg mx-auto max-w-3xl rounded-lg bg-black/50 p-8 text-center shadow-lg backdrop-blur-sm"
              >
                {{ .Content }}
              </div>
            </div>
          </div>
        {{ end }}
      </div>

      <script>
        // Smooth scrolling
        document.querySelectorAll(".nav-link").forEach((anchor) => {
          anchor.addEventListener("click", function (e) {
            e.preventDefault();
            document.querySelector(this.getAttribute("href")).scrollIntoView({
              behavior: "smooth",
            });
          });
        });

        // Scrollspy functionality
        const sections = document.querySelectorAll(
          "section[id], div[id^='section']"
        );
        const navLinks = document.querySelectorAll(".nav-link");

        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                const id = entry.target.id;
                navLinks.forEach((link) => {
                  link.classList.remove("bg-gray-700");
                  if (link.dataset.link === id) {
                    link.classList.add("bg-gray-700");
                  }
                });
              }
            });
          },
          { threshold: 0.7 }
        );

        sections.forEach((section) => observer.observe(section));

        // Navbar background change on scroll
        const navbar = document.getElementById("navbar");
        window.addEventListener("scroll", () => {
          if (window.scrollY === 0) {
            navbar.classList.remove("bg-black/80");
            navbar.classList.add("bg-transparent");
          } else {
            navbar.classList.remove("bg-transparent");
            navbar.classList.add("bg-black/80");
          }
        });
      </script>
    </main>
  </body>
</html>
